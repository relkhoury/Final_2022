---
title: "Covid91 vaccine study Final2022"
author: "Rabi Elkhoury"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final_Data.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
options(digits = 2)
```

# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

```{r}
Males <- filter(FinalData, sex == "M")
Females <- filter(FinalData, sex == "F")
LGBTQ <- filter(FinalData, LGBTQ == "gay")
DrugUsers <- filter(FinalData, DrugUser == "yes")
```



## Males


### Descriptive Results

#### Graphical Results
```{r}
dd2 <- Males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

Generating a barplot via ggplot for the data involving the incidence of MALES with COVID-19, along with whether or not they were treated with the vaccine, shows that, though a higher frequency of persons didn't get COVID-19 at all, most of those who did had taken the placebo.  Around 67% of males who contracted COVID-19 had taken the placebo, compared to only about 33% of males who had gotten the disease.  However, more testing is required to ensure such results are statistically significant.  


#### Numerical Results
```{r}
table1 <- xtabs(~treatment + infected, data=Males)
rowPerc(table1)
colPerc(table1)
```
Our numerical results corroborate the graphical descriptive results created above; we can see that, among Males who got COVID-19, 68% of them had taken the placebo, as compared to 32% of males who had gotten the vaccine.  While a majority of males didn't get COVID-19 at all, 3% of those men who received the placebo got the virus, as compared to only 1% of males who got the vaccine.  This further supports the notion that the vaccine aids in protection against the vaccine, but inferential results are required. 



### Inferential Results
```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)
malefisher <- fisher.test(table1)
malefisher
```
Multiple data points generated from our Chi-Square and Fisher Exact tests lend credibility to our earlier tests.  The observed counts from the Chi-Square test show convey that over 100 more males who got the placebo ended up getting COVID-19, as compared to their vaccinated fellows.  Our odds ratio is 2.1, implying that males who get placebo-based treatment are 2.1 times as likely to get COVID-19 as compared to their vaccinated counterparts.  Furthermore, our p-value is infinitesimal, and such a small value suggests our results are statistically significant.  





### Efficacy of Vaccine for Males
```{r}
MaleEfficacy <- malefisher$estimate/(1 + malefisher$estimate) * 100
malefisherlow <- malefisher$conf.int[1]
malefisherhigh <- malefisher$conf.int[2]
EfficacyMalesLow <- ((malefisherlow)/(1 + malefisherlow) * 100)
EfficacyMalesHigh <- ((malefisherhigh)/(1 + malefisherhigh) * 100)
```
The estimated efficacy of the vaccine among male patients is `r MaleEfficacy`%.  The 95% confidence interval for the efficacy of the vaccine pertaining to males is `r EfficacyMalesLow`% to `r EfficacyMalesHigh`%.




## Females

### Descriptive Results

#### Graphical Results

```{r}
dd3 <- Females %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicG <- ggplot(dd3,aes(x=infected,y=count,fill=treatment))
basicG + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicGG <- ggplot(dd3,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicGG + geom_bar(stat="identity", position = "dodge")
```

Analyzing the bar-plots pertaining to the female COVID-19 infection rate, along with their vaccination status (having received a bonafide vaccine or the placebo) yields results that somewhat mirror those of the male cases.  Our frequency-based bar-plot exhibits that, although most participants did not contract COVID-19 at all, a larger count of those who did seemed to have taken the placebo.  Shifting focus to the proportion-based bar=plot, a strong majority (nearly 60%) of COVID-19 positive cases had taken the placebo, while a lesser minority had taken the vaccine.  Additional numerical and inferential results are necessary to come to a final conclusion on these results.  

#### Numerical Results

```{r}
table2 <- xtabs(~treatment + infected, data=Females)
rowPerc(table2)
colPerc(table2)
```
Viewing our data from a tabular lens further justifies the earlier graphical results investigated; clearly, an immense majority of female persons didn't get COVID-19 at all (note: data displays in whole numbers because of options(digits = 1) command), but a majority of those who did (59%) had taken the placebo instead of the vaccine (41%).  As with the male data, there is mounting evidence that those who received the vaccine may be notably protected against COVID-19 infection, but legitimate inferential test is required to validate this.  


### Inferential Results

```{r}
chisq.test(table2)
chisqtestGC(table2)
fisher.test(table2)
femalefisher <- fisher.test(table2)
femalefisher
```
Running our Chi-Square and FisherExact tests confirm our earlier established assumptions about the female COVID-19 statistics collected.  Our observed counts indicate that 64 more females who took the placebo contracted COVID-19, as compared to females who genuinely been inoculated.  Our odds ratio was calculated to be 1.4; this can be interpreted as that those females who only took the placebo have a 1.4 times higher chance of contracting COVID-19, compared to their vaccinated counterparts.  Furthermore, our p-value computation is essentially zero, affirming that our results are statistically significant.  


### Efficacy of Vaccine for Females
```{r}
FemaleEfficacy <- femalefisher$estimate/(1 + femalefisher$estimate) * 100
Femalefisherlow <- femalefisher$conf.int[1]
Femalefisherhigh <- femalefisher$conf.int[2]
EfficacyFemalesLow <- ((Femalefisherlow)/(1 + Femalefisherlow) * 100)
EfficacyFemalesHigh <- ((Femalefisherhigh)/(1 + Femalefisherhigh) * 100)
```
The estimated efficacy of the vaccine among male patients is `r FemaleEfficacy`%.  The 95% confidence interval for the efficacy of the vaccine pertaining to males is `r EfficacyFemalesLow`% to `r EfficacyFemalesHigh`%.


## LGBTQ

### Descriptive Results


#### Graphical Results
```{r}
dd4 <- LGBTQ %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicD <- ggplot(dd4,aes(x=infected,y=count,fill=treatment))
basicD + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicDD <- ggplot(dd4,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicDD + geom_bar(stat="identity", position = "dodge")
```



#### Numerical Results
```{r}
table3 <- xtabs(~treatment + infected, data=LGBTQ)
rowPerc(table3)
colPerc(table3)
```


### Inferential Results




### Efficacy of Vaccine for Males





## Druggies

### Descriptive Results


#### Graphical Results




#### Numerical Results



### Inferential Results




### Efficacy of Vaccine for Males






